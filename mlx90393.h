#ifndef _MLX90393_H_
#define _MLX90393_H_

#include <stdbool.h>
#include <stdint.h>


//MLX90393 - Magnetometer
//COMMANDS
#define MLX90393_NO_OPERATION					0x00
#define MLX90393_START_BURST_MODE				0x10
#define MLX90393_START_WAKE_UP_ON_CHANGE_MODE	0x20
#define MLX90393_START_SINGLE_MEASUREMENT_MODE	0x30
#define MLX90393_READ_MEASUREMENT				0x40
#define MLX90393_READ_REGISTER					0x50
#define MLX90393_WRITE_REGISTER					0x60
#define MLX90393_EXIT_MODE						0x80
#define MLX90393_MEMORY_RECALL					0xD0
#define MLX90393_MEMORY_STORE					0xE0
#define MLX90393_RESET							0xF0

#define MLX90393_SELECT_ZYXT		0x0F
#define MLX90393_SELECT_ZYX			0x0E
#define MLX90393_SELECT_Z			0x08
#define MLX90393_SELECT_Y			0x04
#define MLX90393_SELECT_X			0x02
#define MLX90393_SELECT_T			0x01

#define MLX90393_SELECT_ALL_ABC		0x07
#define MLX90393_SELECT_A			0x04
#define MLX90393_SELECT_B			0x02
#define MLX90393_SELECT_C			0x01

//REGISTER
#define MLX90393_Z_GAIN_HALL				0x00
#define MLX90393_TRIG_COMM_WOC_TCMP_BURST	0x01
#define MLX90393_OSR_RES_DIG				0x02

#define MLX90393_VOL_MEM_REG_01				0x01
#define MLX90393_VOL_MEM_REG_0A				0x0A
#define MLX90393_VOL_MEM_REG_0B				0x0B
#define MLX90393_VOL_MEM_REG_0C				0x0C

//VALUES

#define MLX90393_TEST_VALUE				0x5A03

//MLX90393_Z_GAIN_HALL PARAMETERS
#define MLX90393_Z_SERIES_ENABLE		0x0080

#define MLX90393_GAIN_SEL_7				0x0070
#define MLX90393_GAIN_SEL_6				0x0060
#define MLX90393_GAIN_SEL_5				0x0050
#define MLX90393_GAIN_SEL_4				0x0040
#define MLX90393_GAIN_SEL_3				0x0030
#define MLX90393_GAIN_SEL_2				0x0020
#define MLX90393_GAIN_SEL_1				0x0010

#define MLX90393_HALL_CONF_SPIN_3		0x000C
#define MLX90393_HALL_CONF_SPIN_2		0x0008
#define MLX90393_HALL_CONF_SPIN_1		0x0004

#define MLX90393_HALL_CONF_CHOP_3		0x0003
#define MLX90393_HALL_CONF_CHOP_2		0x0002
#define MLX90393_HALL_CONF_CHOP_1		0x0001



//MLX90393_TRIG_COMM_WOC_TCMP_BURST PARAMETERS
#define MLX90393_TRIG_INT_DISABLE		0x8000

#define MLX90393_COMM_MODE_BOTH			0x2000
#define MLX90393_COMM_MODE_SPI			0x4000
#define MLX90393_COMM_MODE_I2C			0x6000

#define MLX90393_TCMP_ENABLE			0x0400

#define MLX90393_BURST_RATE_1			0x0001		//1 * 20ms
#define MLX90393_BURST_RATE_5			0x0005		//5 * 20ms
#define MLX90393_BURST_RATE_10			0x000C		//10 * 20ms
#define MLX90393_BURST_RATE_15			0x000F		//15 * 20ms
#define MLX90393_BURST_RATE_20			0x0014		//20 * 20ms
#define MLX90393_BURST_RATE_MAX			0x003F		//63 * 20ms



//MLX90393_OSR_RES_DIG PARAMETERS
#define MLX90393_OSR2_0			0x0000
#define MLX90393_OSR2_1			0x0800
#define MLX90393_OSR2_2			0x1000
#define MLX90393_OSR2_3			0x1800

#define MLX90393_RES_XYZ_3		0x07E0
#define MLX90393_RES_XYZ_2		0x0540
#define MLX90393_RES_XYZ_1		0x02A0

#define MLX90393_DIG_FILT_0		0x0000
#define MLX90393_DIG_FILT_1		0x0004
#define MLX90393_DIG_FILT_2		0x0008
#define MLX90393_DIG_FILT_3		0x000C

#define MLX90393_DIG_FILT_4		0x0010
#define MLX90393_DIG_FILT_5		0x0014
#define MLX90393_DIG_FILT_6		0x0018
#define MLX90393_DIG_FILT_7		0x001C

#define MLX90393_OSR_0			0x0000
#define MLX90393_OSR_1			0x0001
#define MLX90393_OSR_2			0x0002
#define MLX90393_OSR_3			0x0003

#define MLX90393_SERIAL_PORT_SPI			0x00
#define MLX90393_SERIAL_PORT_I2C			0x01

bool initMlx90393(uint8_t , uint8_t );
bool sleepMlx90393(void );
bool wakeMlx90393(void );

bool getMlx90393MagData(uint8_t* );

#endif